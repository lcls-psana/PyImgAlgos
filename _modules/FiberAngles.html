
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>FiberAngles &#8212; pyimgalgos-doc 1 documentation</title>
    <link rel="stylesheet" href="../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head>
  <body>
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="../index.html">pyimgalgos-doc 1 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for FiberAngles</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Class :py:class:`FiberAngles` - contains methods to evaluate angles in fiber diffraction experiments</span>
<span class="sd">====================================================================================================</span>

<span class="sd">Usage::</span>
<span class="sd">    # Import</span>
<span class="sd">    from pyimgalgos.FiberAngles import fraser, calc_phi, calc_beta, funcy</span>

<span class="sd">    # Fraser transformation:</span>
<span class="sd">    s12rot, s3rot, fraser_img = fraser(arr, beta_deg, dist_pix, center=None, oshape=(1500,1500))</span>

<span class="sd">    # HBins objects for Fraser transformation:</span>
<span class="sd">    qh_hbins, qv_hbins = fraser_bins(fraser_img, dist_pix)</span>

<span class="sd">    # Evaluation of fiber tilt angles beta phi (in the image plane) (in transverse to image plane).</span>
<span class="sd">    phi  = calc_phi (x1, y1, x2, y2, dist)</span>
<span class="sd">    beta = calc_beta(x1, y1, phi, dist)</span>

<span class="sd">    #Fit functions</span>
<span class="sd">    yarr = funcy(xarr, phi_deg, bet_deg)</span>

<span class="sd">    yarr = funcy_l1_v0(xarr, phi_deg, bet_deg, DoR=0.4765, sgnrt=-1.)</span>
<span class="sd">    (depric.) yarr = funcy_l1_v1(xarr, phi_deg, bet_deg, DoR=0.4765, sgnrt=-1.)</span>

<span class="sd">    yarr2 = funcy2(xarr, a, b, c)</span>

<span class="sd">    # Conversion methods</span>
<span class="sd">    qx, qy, qz = recipnorm(x, y, z) # returns q/fabs(k) components for 3-d point along k^prime.</span>

<span class="sd">    xe, ye = rqh_to_xy(re, qh) # Returns reciprocal (xe,ye) coordinates of the qh projection on Ewald sphere of radius re.</span>
<span class="sd">    xe, ye, ze = rqhqv_to_xyz(re, qh, qv) # Returns reciprocal (xe,ye,ze) coordinates of the qh,qv projection on Ewald sphere of radius re.</span>

<span class="sd">    # Commands to test in the release directory: </span>
<span class="sd">    # python ./pyimgalgos/src/FiberAngles.py &lt;test-id&gt;</span>
<span class="sd">    # where</span>
<span class="sd">    # &lt;test-id&gt; = 1 - test of the Fraser transformation</span>
<span class="sd">    # &lt;test-id&gt; = 2 - test of the phi angle</span>
<span class="sd">    # &lt;test-id&gt; = 3 - test of the beta angle </span>
<span class="sd">    </span>
<span class="sd">This software was developed for the SIT project.</span>
<span class="sd">If you use all or part of it, please give an appropriate acknowledgment.</span>

<span class="sd">See:</span>
<span class="sd">  - :py:class:`Graphics`</span>
<span class="sd">  - :py:class:`GlobalGraphics`</span>
<span class="sd">  - :py:class:`GlobalUtils`</span>
<span class="sd">  - :py:class:`NDArrGenerators`</span>
<span class="sd">  - :py:class:`Quaternion`</span>
<span class="sd">  - :py:class:`FiberAngles`</span>
<span class="sd">  - :py:class:`FiberIndexing`</span>
<span class="sd">  - :py:class:`PeakData`</span>
<span class="sd">  - :py:class:`PeakStore`</span>
<span class="sd">  - :py:class:`TDCheetahPeakRecord`</span>
<span class="sd">  - :py:class:`TDFileContainer`</span>
<span class="sd">  - :py:class:`TDGroup`</span>
<span class="sd">  - :py:class:`TDMatchRecord`</span>
<span class="sd">  - :py:class:`TDNodeRecord`</span>
<span class="sd">  - :py:class:`TDPeakRecord`</span>
<span class="sd">  - :py:class:`HBins`</span>
<span class="sd">  - :py:class:`HPolar`</span>
<span class="sd">  - :py:class:`HSpectrum`</span>
<span class="sd">  - :py:class:`RadialBkgd`</span>
<span class="sd">  - `Analysis of data for cxif5315  &lt;https://confluence.slac.stanford.edu/display/PSDMInternal/Analysis+of+data+for+cxif5315&gt;`_.</span>

<span class="sd">Created in 2015 by Mikhail Dubrovin</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">##-----------------------------</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span> <span class="c1"># pi, sin, sqrt, ceil, floor, fabs</span>
<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="Storage"><a class="viewcode-back" href="../index.html#FiberAngles.Storage">[docs]</a><span class="k">class</span> <span class="nc">Storage</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Storage class for local data exchange between methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">pass</span></div>

<span class="c1">#------------------------------</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">Storage</span><span class="p">()</span> <span class="c1"># singleton</span>
<span class="c1">##-----------------------------</span>

<span class="k">def</span> <span class="nf">_fillimg</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This method is used in fraser(...), is called in map(_fillimg, irows, icols, arr) and serves to fill image.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">+=</span> <span class="n">a</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">count</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">r</span>
    
<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="fraser_xyz"><a class="viewcode-back" href="../index.html#FiberAngles.fraser_xyz">[docs]</a><span class="k">def</span> <span class="nf">fraser_xyz</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">beta_deg</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Do Fraser transformation for of 3-d points given by x,y,z arrays for angle beta around x and</span>
<span class="sd">       returns horizontal and vertical components of the scattering vector in units of k (1(def)-relative or eV or 1/A).</span>
<span class="sd">       x,y-arrays representing image point coordinates, z-can be scalar - distance from sample to detector.</span>
<span class="sd">       x, y, and z should be in the same units; ex.: number of pixels (109.92um) or [um], angle is in degrees.</span>
<span class="sd">       Example: fraser_xy(x,y,909,10); (10 degrees at 909 pixel (100mm) distance)</span>

<span class="sd">       ASSUMPTION:</span>
<span class="sd">       - x,y,z    - [in] point coordinate arrays with originn in IP</span>
<span class="sd">       - beta_deg - [in] angle beta in degrees</span>
<span class="sd">       - k        - [in] scale factor, ex.: wave number in units of (eV or 1/A).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="o">+</span><span class="n">z</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">d</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">z</span><span class="o">/</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="n">d</span>

    <span class="n">cb</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">beta_deg</span><span class="p">))</span>
    <span class="n">sb</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">beta_deg</span><span class="p">))</span>

    <span class="n">s1rot</span> <span class="o">=</span> <span class="n">s1</span>
    <span class="n">s2rot</span> <span class="o">=</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">cb</span> <span class="o">-</span> <span class="n">s3</span> <span class="o">*</span> <span class="n">sb</span>
    <span class="n">s3rot</span> <span class="o">=</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">sb</span> <span class="o">+</span> <span class="n">s3</span> <span class="o">*</span> <span class="n">cb</span>

    <span class="n">s12rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">s1rot</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">s1rot</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">s2rot</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">s12rot</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="n">s3rot</span><span class="o">*</span><span class="n">k</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="fraser"><a class="viewcode-back" href="../index.html#FiberAngles.fraser">[docs]</a><span class="k">def</span> <span class="nf">fraser</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">beta_deg</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">oshape</span><span class="o">=</span><span class="p">(</span><span class="mi">1500</span><span class="p">,</span><span class="mi">1500</span><span class="p">))</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Do Fraser correction for an array at angle beta and sample-to-detector distance z, given in</span>
<span class="sd">       number of pixels (109.92um), angle is in degrees.</span>
<span class="sd">       Example: fraser(array,10,909); (10 degrees at 100mm distance)</span>

<span class="sd">       ASSUMPTION:</span>
<span class="sd">       1. by default 2-d arr image center corresponds to (x,y) origin </span>
<span class="sd">       - arr      - [in] 2-d image array</span>
<span class="sd">       - beta_deg - [in] angle beta in degrees</span>
<span class="sd">       - z        - [in] distance from sample to detector given in units of pixel size (110um)</span>
<span class="sd">       - center   - [in] center (row,column) location on image, which will be used as (x,y) origin </span>
<span class="sd">       - oshape   - [in] ouitput image shape</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">sizex</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">sizey</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span> <span class="o">=</span> <span class="n">center</span> <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">sizex</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">sizey</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> 

    <span class="n">xarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="o">-</span><span class="n">xc</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">sizex</span><span class="o">-</span><span class="n">xc</span><span class="p">))</span>
    <span class="n">yarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="o">-</span><span class="n">yc</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">sizey</span><span class="o">-</span><span class="n">yc</span><span class="p">))</span>

    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">yarr</span><span class="p">,</span> <span class="n">xarr</span><span class="p">)</span> <span class="c1">### SWAPPED yarr, xarr to keep correct shape for grids</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="o">+</span><span class="n">z</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">d</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">z</span><span class="o">/</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="n">d</span>

    <span class="n">cb</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">beta_deg</span><span class="p">))</span>
    <span class="n">sb</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">beta_deg</span><span class="p">))</span>

    <span class="n">s1rot</span> <span class="o">=</span> <span class="n">s1</span>
    <span class="n">s2rot</span> <span class="o">=</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">cb</span> <span class="o">-</span> <span class="n">s3</span> <span class="o">*</span> <span class="n">sb</span>
    <span class="n">s3rot</span> <span class="o">=</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">sb</span> <span class="o">+</span> <span class="n">s3</span> <span class="o">*</span> <span class="n">cb</span>

    <span class="n">s12rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">s1rot</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">s2rot</span><span class="p">))</span>
    <span class="n">s12rot</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">sizex</span><span class="o">-</span><span class="n">xc</span><span class="p">))]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="n">s12rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">s12rot</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
    <span class="n">s3rot</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">s3rot</span>  <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>

    <span class="n">orows</span><span class="p">,</span> <span class="n">orows1</span> <span class="o">=</span> <span class="n">oshape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oshape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">ocols</span><span class="p">,</span> <span class="n">ocols1</span> <span class="o">=</span> <span class="n">oshape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">oshape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
    
    <span class="n">icols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s12rot</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ocols</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
    <span class="n">irows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s3rot</span>  <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">orows</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>

    <span class="n">irows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">irows</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">irows</span><span class="o">&gt;</span><span class="n">orows1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">orows1</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="n">irows</span><span class="p">)</span>
    <span class="n">icols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">icols</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">icols</span><span class="o">&gt;</span><span class="n">ocols1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ocols1</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="n">icols</span><span class="p">)</span>

    <span class="n">sp</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">oshape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">sp</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">oshape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>

    <span class="n">unused_lst</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">_fillimg</span><span class="p">,</span> <span class="n">irows</span><span class="p">,</span> <span class="n">icols</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>

    <span class="c1">#print &#39;arr.shape: &#39;, arr.shape</span>
    <span class="c1">#print &#39;s3rot.shape: &#39;, s3rot.shape</span>
    <span class="c1">#print &#39;s12rot.shape: &#39;, s12rot.shape</span>
    <span class="c1">#print &#39;reciparr.shape: &#39;, reciparr.shape</span>
    <span class="c1">#print &#39;count min=%d, max=%d&#39; % (sp.count.min(), sp.count.max())    </span>

    <span class="n">countpro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">sp</span><span class="o">.</span><span class="n">count</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
    <span class="n">reciparr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">countpro</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">sp</span><span class="o">.</span><span class="n">image</span><span class="o">/</span><span class="n">countpro</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">s12rot</span><span class="p">,</span> <span class="n">s3rot</span><span class="p">,</span> <span class="n">reciparr</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="fraser_bins"><a class="viewcode-back" href="../index.html#FiberAngles.fraser_bins">[docs]</a><span class="k">def</span> <span class="nf">fraser_bins</span><span class="p">(</span><span class="n">fraser_img</span><span class="p">,</span> <span class="n">dist_pix</span><span class="p">,</span> <span class="n">dqv</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns horizontal and vertical HBins objects for pixels in units of k=1</span>
<span class="sd">    Fraser imaging array, returned by method fraser(...).</span>
<span class="sd">    Units: sample to detector distance dist_pix given in pixels, </span>
<span class="sd">    dqv - normalized offset for qv (for l=1 etc.)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pyimgalgos.HBins</span> <span class="k">import</span> <span class="n">HBins</span>

    <span class="n">rows</span><span class="p">,</span><span class="n">cols</span> <span class="o">=</span> <span class="n">fraser_img</span><span class="o">.</span><span class="n">shape</span>
    <span class="c1"># this is how Fraser&#39;s image pixel defined relative to the scale factor dist_pix</span>
    <span class="n">qhmax</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">cols</span><span class="o">/</span><span class="n">dist_pix</span>
    <span class="n">qvmax</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">rows</span><span class="o">/</span><span class="n">dist_pix</span>
    <span class="n">qh_bins</span> <span class="o">=</span> <span class="n">HBins</span><span class="p">((</span><span class="o">-</span><span class="n">qhmax</span><span class="p">,</span> <span class="n">qhmax</span><span class="p">),</span> <span class="n">cols</span><span class="p">,</span> <span class="n">vtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">qv_bins</span> <span class="o">=</span> <span class="n">HBins</span><span class="p">((</span><span class="o">-</span><span class="n">qvmax</span><span class="o">+</span><span class="n">dqv</span><span class="p">,</span> <span class="n">qvmax</span><span class="o">+</span><span class="n">dqv</span><span class="p">),</span> <span class="n">rows</span><span class="p">,</span> <span class="n">vtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qh_bins</span><span class="p">,</span> <span class="n">qv_bins</span></div>

<span class="c1">#------------------------------</span>

<div class="viewcode-block" id="rotation_cs"><a class="viewcode-back" href="../index.html#FiberAngles.rotation_cs">[docs]</a><span class="k">def</span> <span class="nf">rotation_cs</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;For numpy arrays X and Y returns the numpy arrays of Xrot and Yrot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Xrot</span> <span class="o">=</span> <span class="n">X</span><span class="o">*</span><span class="n">C</span> <span class="o">-</span> <span class="n">Y</span><span class="o">*</span><span class="n">S</span> 
    <span class="n">Yrot</span> <span class="o">=</span> <span class="n">Y</span><span class="o">*</span><span class="n">C</span> <span class="o">+</span> <span class="n">X</span><span class="o">*</span><span class="n">S</span> 
    <span class="k">return</span> <span class="n">Xrot</span><span class="p">,</span> <span class="n">Yrot</span></div>

<span class="c1">#------------------------------</span>

<div class="viewcode-block" id="rotation"><a class="viewcode-back" href="../index.html#FiberAngles.rotation">[docs]</a><span class="k">def</span> <span class="nf">rotation</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;For numpy arrays X and Y returns the numpy arrays of Xrot and Yrot rotated by angle_deg</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">angle_rad</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span>
    <span class="n">S</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rad</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rotation_cs</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span></div>

<span class="c1">#------------------------------</span>

<div class="viewcode-block" id="rotation_phi_beta"><a class="viewcode-back" href="../index.html#FiberAngles.rotation_phi_beta">[docs]</a><span class="k">def</span> <span class="nf">rotation_phi_beta</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">phi_deg</span><span class="p">,</span> <span class="n">beta_deg</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns horizontal and vertical components of the scattering vector in units of scale (k)</span>
<span class="sd">       x, y can be arrays, z-scalar in the same units, ex. scale = k[1/A] or in number of pixels etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xrot</span><span class="p">,</span> <span class="n">yrot</span> <span class="o">=</span> <span class="n">rotation</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">phi_deg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fraser_xyz</span><span class="p">(</span><span class="n">xrot</span><span class="p">,</span> <span class="n">yrot</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">beta_deg</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="calc_phi"><a class="viewcode-back" href="../index.html#FiberAngles.calc_phi">[docs]</a><span class="k">def</span> <span class="nf">calc_phi</span><span class="p">(</span><span class="n">x1pix</span><span class="p">,</span> <span class="n">y1pix</span><span class="p">,</span> <span class="n">x2pix</span><span class="p">,</span> <span class="n">y2pix</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Evaluates fiber phi angle [rad] for two peaks in equatorial region</span>
<span class="sd">       - x1pix - [in] x coordinate of the 1st point</span>
<span class="sd">       - y1pix - [in] y coordinate of the 1st point </span>
<span class="sd">       - x1pix - [in] x coordinate of the 2nd point </span>
<span class="sd">       - y1pix - [in] y coordinate of the 2nd point </span>
<span class="sd">       - dist  - [in] distance from sample to detector</span>
<span class="sd">    &quot;&quot;&quot;</span>	
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x1pix</span> <span class="o">/</span> <span class="n">dist</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">y1pix</span> <span class="o">/</span> <span class="n">dist</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">x2pix</span> <span class="o">/</span> <span class="n">dist</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">y2pix</span> <span class="o">/</span> <span class="n">dist</span>	
    <span class="n">d1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x1</span><span class="o">*</span><span class="n">x1</span> <span class="o">+</span> <span class="n">y1</span><span class="o">*</span><span class="n">y1</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x2</span><span class="o">*</span><span class="n">x2</span> <span class="o">+</span> <span class="n">y2</span><span class="o">*</span><span class="n">y2</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">((</span><span class="n">y2</span><span class="o">*</span><span class="n">d1</span> <span class="o">-</span> <span class="n">y1</span><span class="o">*</span><span class="n">d2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x1</span><span class="o">*</span><span class="n">d2</span> <span class="o">-</span> <span class="n">x2</span><span class="o">*</span><span class="n">d1</span><span class="p">))</span> </div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="calc_beta"><a class="viewcode-back" href="../index.html#FiberAngles.calc_beta">[docs]</a><span class="k">def</span> <span class="nf">calc_beta</span><span class="p">(</span><span class="n">xpix</span><span class="p">,</span> <span class="n">ypix</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Evaluates fiber beta angle [rad] for two peaks in equatorial region</span>
<span class="sd">       - xpix - [in] x coordinate of the point</span>
<span class="sd">       - ypix - [in] y coordinate of the point </span>
<span class="sd">       - phi  - [in] fiber tilt angle [rad] if the detector plane</span>
<span class="sd">       - dist - [in] distance from sample to detector</span>
<span class="sd">    &quot;&quot;&quot;</span>	
    <span class="n">x1</span> <span class="o">=</span> <span class="n">xpix</span> <span class="o">/</span> <span class="n">dist</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">ypix</span> <span class="o">/</span> <span class="n">dist</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">x1</span><span class="o">*</span><span class="n">x1</span> <span class="o">+</span> <span class="n">y1</span><span class="o">*</span><span class="n">y1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">((</span><span class="n">y1</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">+</span> <span class="n">x1</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="funcy_l0"><a class="viewcode-back" href="../index.html#FiberAngles.funcy_l0">[docs]</a><span class="k">def</span> <span class="nf">funcy_l0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi_deg</span><span class="p">,</span> <span class="n">bet_deg</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Function for parameterization of y(x, phi, beta)</span>
<span class="sd">       of peaks in mediane plane for fiber diffraction</span>
<span class="sd">       ATTENTION!: curve_fit assumes that x and returned y are numpy arrays.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">INFI</span><span class="p">,</span> <span class="n">ZERO</span> <span class="o">=</span> <span class="mf">1e20</span><span class="p">,</span> <span class="mf">1e-20</span>
    <span class="n">phi</span><span class="p">,</span> <span class="n">bet</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">phi_deg</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">bet_deg</span><span class="p">)</span>
    <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">sb</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">bet</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">bet</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sb</span> <span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">s</span><span class="o">/</span><span class="n">c</span> <span class="k">if</span> <span class="n">c</span> <span class="k">else</span> <span class="n">INFI</span> 

    <span class="n">t</span> <span class="o">=</span> <span class="n">sb</span><span class="o">/</span><span class="n">cb</span> <span class="k">if</span> <span class="n">cb</span> <span class="k">else</span> <span class="n">INFI</span>
    <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="n">t</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="n">t</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span> <span class="k">else</span> <span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">INFI</span><span class="p">,</span> <span class="n">c</span><span class="o">*</span><span class="n">INFI</span><span class="p">)</span>

    <span class="n">denum</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span> <span class="k">else</span> <span class="n">ZERO</span>

    <span class="n">B</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">denum</span>
    <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">denum</span>
    <span class="n">sqarg</span> <span class="o">=</span> <span class="n">B</span><span class="o">*</span><span class="n">B</span><span class="o">-</span><span class="n">C</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqarg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">sqarg</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;WARNING in funcy_l0: solution does not exist because of sqarg&lt;0 :&#39;</span><span class="p">,</span> <span class="n">sqarg</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sqarg</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;WARNING in funcy_l0: solution does not exist because of sqarg&lt;0 :&#39;</span><span class="p">,</span> <span class="n">sqarg</span>

    <span class="n">sqapro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">sqarg</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,],</span> <span class="p">[</span><span class="n">sqarg</span><span class="p">,],</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">B</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">B</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sqapro</span><span class="p">)</span></div>

<span class="c1">##-----------------------------</span>

<span class="c1"># DEPRICATED methods alias for funcy_l0(x, phi, beta)</span>
<span class="n">funcy_v0</span> <span class="o">=</span> <span class="n">funcy_l0</span>
<span class="n">funcy</span> <span class="o">=</span> <span class="n">funcy_l0</span>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="funcy_l1_v0"><a class="viewcode-back" href="../index.html#FiberAngles.funcy_l1_v0">[docs]</a><span class="k">def</span> <span class="nf">funcy_l1_v0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi_deg</span><span class="p">,</span> <span class="n">bet_deg</span><span class="p">,</span> <span class="n">DoR</span><span class="o">=</span><span class="mf">0.474</span><span class="p">,</span> <span class="n">sgnrt</span><span class="o">=-</span><span class="mf">1.</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;DEPRICATED: D/L - is not a constant as it should be</span>
<span class="sd">       Function for parameterization of y(x, phi, beta). v0: EQUATION FOR D/L=...</span>
<span class="sd">       of peaks in l=1 plane for fiber diffraction</span>
<span class="sd">       DoR = d/R ratio, where d is a distance between l=0 and l=1 on image,</span>
<span class="sd">       DoR = 433/913.27 - default constant</span>
<span class="sd">       R is sample to detector distance</span>
<span class="sd">       ATTENTION!: curve_fit assumes that x and returned y are numpy arrays.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">INFI</span><span class="p">,</span> <span class="n">ZERO</span> <span class="o">=</span> <span class="mf">1e20</span><span class="p">,</span> <span class="mf">1e-20</span>
    <span class="n">phi</span><span class="p">,</span> <span class="n">bet</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">phi_deg</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">bet_deg</span><span class="p">)</span>
    <span class="n">sb</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">bet</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">bet</span><span class="p">)</span>
    <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sb</span> <span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">DoR</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">c</span> <span class="k">if</span> <span class="n">c</span> <span class="k">else</span> <span class="n">INFI</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">sb</span><span class="o">/</span><span class="n">cb</span> <span class="k">if</span> <span class="n">cb</span> <span class="k">else</span> <span class="n">INFI</span>
    <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="n">t</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="n">t</span>
    <span class="n">G</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">DoR</span><span class="o">/</span><span class="n">sb</span> <span class="k">if</span> <span class="n">sb</span> <span class="k">else</span> <span class="n">INFI</span>
    <span class="n">denum</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span> <span class="k">else</span> <span class="n">ZERO</span>

    <span class="c1"># parameters of of y^2 + 2By + C = 0 </span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">s</span><span class="o">+</span><span class="n">G</span><span class="p">)</span><span class="o">/</span><span class="n">denum</span>
    <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="n">G</span> <span class="o">+</span> <span class="n">G</span><span class="o">*</span><span class="n">G</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">denum</span>
    <span class="n">sqarg</span> <span class="o">=</span> <span class="n">B</span><span class="o">*</span><span class="n">B</span><span class="o">-</span><span class="n">C</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqarg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">sqarg</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;WARNING in funcy_l1_v0: solution does not exist because of sqarg&lt;0 :&#39;</span><span class="p">,</span> <span class="n">sqarg</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sqarg</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;WARNING in funcy_l1_v0: solution does not exist because of sqarg&lt;0 :&#39;</span><span class="p">,</span> <span class="n">sqarg</span>

    <span class="n">sqapro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">sqarg</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,],</span> <span class="p">[</span><span class="n">sqarg</span><span class="p">,],</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1">#sign = 1 if bet&lt;-13 else -1</span>
    <span class="c1">#return -B + sign * np.sqrt(sqapro)</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">B</span> <span class="o">+</span> <span class="n">sgnrt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sqapro</span><span class="p">)</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="funcy_l1_v1"><a class="viewcode-back" href="../index.html#FiberAngles.funcy_l1_v1">[docs]</a><span class="k">def</span> <span class="nf">funcy_l1_v1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi_deg</span><span class="p">,</span> <span class="n">bet_deg</span><span class="p">,</span> <span class="n">DoR</span><span class="o">=</span><span class="mf">0.4292</span><span class="p">,</span> <span class="n">sgnrt</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;v0: EQUATION FOR D/R. Function for parameterization of y(x, phi, beta)</span>
<span class="sd">       of peaks in l=1 plane for fiber diffraction</span>
<span class="sd">       DoR = d/R ratio, where d is a distance between l=0 and l=1 on image,</span>
<span class="sd">       DoR = 392/913.27 - default</span>
<span class="sd">       R is sample to detector distance</span>
<span class="sd">       ATTENTION!: curve_fit assumes that x and returned y are numpy arrays.</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="n">INFI</span><span class="p">,</span> <span class="n">ZERO</span> <span class="o">=</span> <span class="mf">1e20</span><span class="p">,</span> <span class="mf">1e-20</span>
    <span class="n">phi</span><span class="p">,</span> <span class="n">bet</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">phi_deg</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">bet_deg</span><span class="p">)</span>
    <span class="n">sb</span><span class="p">,</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">bet</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">bet</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">sb</span><span class="o">/</span><span class="n">cb</span> <span class="k">if</span> <span class="n">cb</span> <span class="k">else</span> <span class="n">INFI</span>
    <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">sb</span> <span class="p">:</span>
        <span class="n">G</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">DoR</span><span class="o">/</span><span class="n">sb</span> <span class="k">if</span> <span class="n">sb</span> <span class="k">else</span> <span class="n">INFI</span>
        <span class="n">g</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">G</span> <span class="k">if</span> <span class="n">G</span> <span class="k">else</span> <span class="n">INFI</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span><span class="o">*</span><span class="n">s</span><span class="o">/</span><span class="n">t</span><span class="p">,</span> <span class="n">g</span><span class="o">*</span><span class="n">c</span><span class="o">/</span><span class="n">t</span><span class="p">)</span> <span class="k">if</span> <span class="n">t</span> <span class="k">else</span> <span class="p">(</span><span class="n">g</span><span class="o">*</span><span class="n">s</span><span class="o">*</span><span class="n">INFI</span><span class="p">,</span> <span class="n">g</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">INFI</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">cb</span><span class="o">/</span><span class="n">DoR</span><span class="p">,</span> <span class="n">c</span><span class="o">*</span><span class="n">cb</span><span class="o">/</span><span class="n">DoR</span>
    <span class="n">denum</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span> <span class="k">else</span> <span class="n">ZERO</span>

    <span class="c1"># parameters of of y^2 + 2By + C = 0 </span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">s</span><span class="o">+</span><span class="n">g</span><span class="p">)</span><span class="o">/</span><span class="n">denum</span>
    <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">s</span> <span class="o">+</span> <span class="n">g</span><span class="o">*</span><span class="n">g</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">denum</span>
    <span class="n">sqarg</span> <span class="o">=</span> <span class="n">B</span><span class="o">*</span><span class="n">B</span><span class="o">-</span><span class="n">C</span>

    <span class="c1">#print &#39;s:%8.3f  c:%8.3f  sb:%8.3f  cb:%8.3f  t:%8.3f  g:%8.3f  denum:%8.3f&#39; % (s, c, sb, cb, t, g, denum),\</span>
    <span class="c1">#      &#39;  B:&#39;, B, &#39;  C:&#39;, C, &#39;  sqarg:&#39;, sqarg</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sqarg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">sqarg</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;WARNING in funcy_l1_v1: solution does not exist because of sqarg&lt;0 :&#39;</span><span class="p">,</span> <span class="n">sqarg</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sqarg</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">v</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;WARNING in funcy_l1_v1: solution does not exist because of sqarg&lt;0 :&#39;</span><span class="p">,</span> <span class="n">sqarg</span>

    <span class="n">sqapro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">sqarg</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,],</span> <span class="p">[</span><span class="n">sqarg</span><span class="p">,],</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1">#sgn = 1. if bet&gt;-13.3 else -1.</span>
    <span class="c1">#return -B + sign*np.sqrt(sqapro)</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">B</span> <span class="o">+</span> <span class="n">sgnrt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sqapro</span><span class="p">)</span></div>
    <span class="c1">#return -B + sgn * np.sqrt(sqapro)</span>
    <span class="c1">#return -B - np.sign(B)*np.sqrt(sqapro)</span>
<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="funcy2"><a class="viewcode-back" href="../index.html#FiberAngles.funcy2">[docs]</a><span class="k">def</span> <span class="nf">funcy2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Quadratic polynomial function to test curve_fit.</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">c</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="rqh_to_xz"><a class="viewcode-back" href="../index.html#FiberAngles.rqh_to_xz">[docs]</a><span class="k">def</span> <span class="nf">rqh_to_xz</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">qh</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns reciprocal (qxe,qze) coordinates of the qh projection on Ewald sphere of radius re.</span>

<span class="sd">    Parameters</span>

<span class="sd">      - re - (float scalar) Ewald sphere radius (1/A)</span>
<span class="sd">      - qh - (numpy array) horizontal component of q values (1/A)</span>

<span class="sd">    Assumption: </span>
<span class="sd">       reciprocal frame origin (0,0) is on Ewald sphere,  </span>
<span class="sd">       center of the Ewald sphere is in (-re,0), </span>
<span class="sd">       qh is a length of the Ewald sphere chorde from origin to the point with peak.</span>
<span class="sd">       NOTE: qh, sina, cosa, qxe, qze - can be numpy arrays shaped as qh.</span>
<span class="sd">       Returns: qxe, qze - coordinates of the point on Ewald sphere equivalent to q(re,qh);</span>
<span class="sd">       Ewald sphere frame has an experiment/detector-like definition of axes;</span>
<span class="sd">       - qze - along the beam,</span>
<span class="sd">       - qxe - transverse to the beam in l=0 horizontal plane.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sina</span> <span class="o">=</span> <span class="n">qh</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">re</span><span class="p">)</span>
    <span class="n">sqa</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">-</span><span class="n">sina</span><span class="o">*</span><span class="n">sina</span>
    <span class="n">sqapro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">sqa</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,],</span> <span class="p">[</span><span class="n">sqa</span><span class="p">,],</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">cosa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sqapro</span><span class="p">)</span>
    <span class="c1">#qxe, qze =  qh*cosa, -qh*sina</span>
    <span class="k">return</span>  <span class="n">qh</span><span class="o">*</span><span class="n">cosa</span><span class="p">,</span> <span class="o">-</span><span class="n">qh</span><span class="o">*</span><span class="n">sina</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="rqhqv_to_xyz"><a class="viewcode-back" href="../index.html#FiberAngles.rqhqv_to_xyz">[docs]</a><span class="k">def</span> <span class="nf">rqhqv_to_xyz</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">qh</span><span class="p">,</span> <span class="n">qv</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns reciprocal (xe,ye,ze) coordinates of the q(re,qh,qv) projections on Ewald sphere frame.</span>
<span class="sd">       Reciprocal frame has origin on Ewald sphere and experiment/detector-like definition of axes;</span>
<span class="sd">       ze - along the beam,</span>
<span class="sd">       xe, ye - transverse to the beam in horizontal and vertical plane, respectively.</span>
<span class="sd">       Need in this method for l=1 or other 3-d cases.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">qh2</span> <span class="o">=</span> <span class="n">qh</span><span class="o">*</span><span class="n">qh</span>
    <span class="n">qv2</span> <span class="o">=</span> <span class="n">qv</span><span class="o">*</span><span class="n">qv</span>
    <span class="n">qze</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">qh2</span><span class="o">+</span><span class="n">qv2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">re</span><span class="p">)</span>
    <span class="n">sqa</span> <span class="o">=</span> <span class="n">qh2</span> <span class="o">-</span> <span class="n">qze</span><span class="o">*</span><span class="n">qze</span>
    <span class="n">sqapro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">sqa</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,],</span> <span class="p">[</span><span class="n">sqa</span><span class="p">,],</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">qxe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sqapro</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">qh</span><span class="p">)</span>
    <span class="n">qye</span> <span class="o">=</span> <span class="n">qv</span>
    <span class="k">return</span>  <span class="n">qxe</span><span class="p">,</span> <span class="n">qye</span><span class="p">,</span> <span class="n">qze</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="qh_to_xy"><a class="viewcode-back" href="../index.html#FiberAngles.qh_to_xy">[docs]</a><span class="k">def</span> <span class="nf">qh_to_xy</span><span class="p">(</span><span class="n">qh</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Alias to DEPRICATED method with swaped parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">qxe</span><span class="p">,</span> <span class="n">qze</span> <span class="o">=</span> <span class="n">rqh_to_xz</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">qh</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">qze</span><span class="p">,</span> <span class="n">qxe</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="recipnorm"><a class="viewcode-back" href="../index.html#FiberAngles.recipnorm">[docs]</a><span class="k">def</span> <span class="nf">recipnorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Returns normalizd reciprocal space coordinates (qx,qy,qz)</span>
<span class="sd">       of the scattering vector q = (k^prime - k)/abs(k),</span>
<span class="sd">       and assuming that</span>
<span class="sd">       - scattering point is a 3-d space origin, also center of the Ewalds sphere</span>
<span class="sd">       - k points from 3-d space origin to the point with coordinates x, y, z</span>
<span class="sd">       (pixel coordinates relative to IP)</span>
<span class="sd">       - scattering is elastic, no energy loss or gained, abs(k^prime)=abs(k)</span>
<span class="sd">       - reciprocal space origin is in the intersection point of axes z and Ewald&#39;s sphere. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">z</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">x</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="n">y</span><span class="o">/</span><span class="n">L</span><span class="p">,</span> <span class="n">z</span><span class="o">/</span><span class="n">L</span><span class="o">-</span><span class="mf">1.</span></div>

<span class="c1">##-----------------------------</span>
<span class="c1">##---------- TESTS ------------</span>
<span class="c1">##-----------------------------</span>

<span class="k">def</span> <span class="nf">test_plot_phi</span><span class="p">()</span> <span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;&quot;&quot;Test plot for phi angle&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">pyimgalgos.GlobalGraphics</span> <span class="k">as</span> <span class="nn">gg</span>

    <span class="n">xarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">tet</span> <span class="o">=</span> <span class="o">-</span><span class="mi">12</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="n">tet</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>  <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">tet</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>  <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="n">tet</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>  <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="n">tet</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y4</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">tet</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y5</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span> <span class="n">tet</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    
    <span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">gg</span><span class="o">.</span><span class="n">plotGraph</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">window</span><span class="o">=</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span><span class="s1">&#39;r-&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span><span class="s1">&#39;y-&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span><span class="s1">&#39;m-&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y5</span><span class="p">,</span><span class="s1">&#39;g.&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;tet=-12, phi=10,0,-5,-6,-7,-10&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="c1">#gg.savefig(&#39;variation-phi.png&#39;)</span>
    <span class="n">gg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">##-----------------------------</span>

<span class="k">def</span> <span class="nf">test_plot_beta</span><span class="p">()</span> <span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;&quot;&quot;Test plot for beta angle&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">pyimgalgos.GlobalGraphics</span> <span class="k">as</span> <span class="nn">gg</span>

    <span class="n">xarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>   <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>  <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>  <span class="o">-</span><span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y3</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>  <span class="o">-</span><span class="mi">6</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y4</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>  <span class="o">-</span><span class="mi">7</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y5</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y6</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>   <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y7</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>   <span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y8</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>  <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    
    <span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">gg</span><span class="o">.</span><span class="n">plotGraph</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">window</span><span class="o">=</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">))</span> 
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span><span class="s1">&#39;r-&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span><span class="s1">&#39;y-&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span><span class="s1">&#39;b-&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span><span class="s1">&#39;m-&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y5</span><span class="p">,</span><span class="s1">&#39;g-&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y6</span><span class="p">,</span><span class="s1">&#39;r.&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y7</span><span class="p">,</span><span class="s1">&#39;g.&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y8</span><span class="p">,</span><span class="s1">&#39;b.&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;phi=0, theta=10, 5, 2, 0,-2,-5,-6,-7,-10&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="c1">#gg.savefig(&#39;variation-theta.png&#39;)</span>
    <span class="n">gg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">##-----------------------------</span>

<span class="k">def</span> <span class="nf">test_plot_beta_l0</span><span class="p">()</span> <span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;&quot;&quot;Test plot for beta angle&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">pyimgalgos.GlobalGraphics</span> <span class="k">as</span> <span class="nn">gg</span>

    <span class="n">xarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cmt</span> <span class="o">=</span> <span class="s1">&#39;l0&#39;</span>


    
    <span class="n">y_000</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy_l0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>   <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y_p10</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy_l0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>  <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y_p20</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy_l0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>  <span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y_p30</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy_l0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>  <span class="mi">30</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y_p40</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy_l0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>  <span class="mi">40</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y_p50</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy_l0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>  <span class="mi">50</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span> <span class="c1"># 48</span>
    <span class="n">y_m10</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy_l0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y_m20</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy_l0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y_m30</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy_l0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>    
    <span class="n">y_m40</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy_l0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>    
    <span class="n">y_m50</span> <span class="o">=</span> <span class="p">[</span><span class="n">funcy_l0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span> <span class="c1"># -48</span>

    <span class="c1">#fig2, ax2 = gg.plotGraph(xarr, y_m01, pfmt=&#39;k.&#39;, figsize=(10,5), window=(0.15, 0.10, 0.78, 0.80)) </span>
    <span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">gg</span><span class="o">.</span><span class="n">plotGraph</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_000</span><span class="p">,</span> <span class="n">pfmt</span><span class="o">=</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">window</span><span class="o">=</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> 

    <span class="c1">#b: blue</span>
    <span class="c1">#g: green</span>
    <span class="c1">#r: red</span>
    <span class="c1">#c: cyan</span>
    <span class="c1">#m: magenta</span>
    <span class="c1">#y: yellow</span>
    <span class="c1">#k: black</span>
    <span class="c1">#w: white</span>


    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_p50</span><span class="p">,</span><span class="s1">&#39;g-x&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39; 50&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_p40</span><span class="p">,</span><span class="s1">&#39;m-&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39; 40&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_p30</span><span class="p">,</span><span class="s1">&#39;b-&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39; 30&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_p20</span><span class="p">,</span><span class="s1">&#39;y-&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39; 20&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_p10</span><span class="p">,</span><span class="s1">&#39;r-&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39; 10&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_000</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;  0&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m10</span><span class="p">,</span><span class="s1">&#39;r.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-10&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m20</span><span class="p">,</span><span class="s1">&#39;y.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-20&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m30</span><span class="p">,</span><span class="s1">&#39;b.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-30&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m40</span><span class="p">,</span><span class="s1">&#39;m.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-40&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m50</span><span class="p">,</span><span class="s1">&#39;g+&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-50&#39;</span><span class="p">)</span>
                                        
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: phi=</span><span class="si">%.1f</span><span class="s1">, beta=[-50,50]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmt</span><span class="p">,</span><span class="n">phi</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">gg</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;test-plot-beta-l0.png&#39;</span><span class="p">)</span>
    <span class="n">gg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">##-----------------------------</span>
    <span class="c1">#b: blue</span>
    <span class="c1">#g: green</span>
    <span class="c1">#r: red</span>
    <span class="c1">#c: cyan</span>
    <span class="c1">#m: magenta</span>
    <span class="c1">#y: yellow</span>
    <span class="c1">#k: black</span>
    <span class="c1">#w: white</span>
<span class="c1">##-----------------------------</span>

<span class="k">def</span> <span class="nf">test_plot_beta_l1</span><span class="p">(</span><span class="n">DoR</span><span class="o">=</span><span class="mf">0.4292</span><span class="p">,</span> <span class="n">sgnrt</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span> <span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;&quot;&quot;Test plot for beta angle&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">pyimgalgos.GlobalGraphics</span> <span class="k">as</span> <span class="nn">gg</span>

    <span class="n">xarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">fancy_plt</span> <span class="o">=</span> <span class="n">funcy_l1_v1</span>
    <span class="c1">#fancy_plt = funcy_l1_v0</span>

    <span class="n">cmt</span> <span class="o">=</span> <span class="s1">&#39;POS&#39;</span> <span class="k">if</span> <span class="n">sgnrt</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;NEG&#39;</span> <span class="c1">#&#39;-B -/+ sqrt(B*B-C)&#39;</span>
    <span class="n">cmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-DoR-</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmt</span><span class="p">,</span> <span class="n">DoR</span><span class="p">)</span>
    
    <span class="n">y_p10</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y_000</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y_m10</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y_m13</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">13</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>    
    <span class="n">y_m15</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>    
    <span class="n">y_m20</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y_m30</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    <span class="n">y_m35</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">35</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>    
    <span class="n">y_m40</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
    
    <span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">gg</span><span class="o">.</span><span class="n">plotGraph</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_000</span><span class="p">,</span> <span class="n">pfmt</span><span class="o">=</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">window</span><span class="o">=</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> 
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_p10</span><span class="p">,</span><span class="s1">&#39;g-&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39; 10&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_000</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;  0&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m10</span><span class="p">,</span><span class="s1">&#39;g.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-10&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m13</span><span class="p">,</span><span class="s1">&#39;r-.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-13&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m15</span><span class="p">,</span><span class="s1">&#39;y.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-14&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m20</span><span class="p">,</span><span class="s1">&#39;r.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-20&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m30</span><span class="p">,</span><span class="s1">&#39;c.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-30&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m35</span><span class="p">,</span><span class="s1">&#39;m.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-35&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m40</span><span class="p">,</span><span class="s1">&#39;b+&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-40&#39;</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: phi=</span><span class="si">%.1f</span><span class="s1">, beta=[-40,10]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmt</span><span class="p">,</span><span class="n">phi</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="n">gg</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;test-plot-beta-l1-</span><span class="si">%s</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="n">cmt</span><span class="p">)</span>
    <span class="n">gg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">##-----------------------------</span>
<span class="c1">##-----------------------------</span>
    <span class="c1">#b: blue</span>
    <span class="c1">#g: green</span>
    <span class="c1">#r: red</span>
    <span class="c1">#c: cyan</span>
    <span class="c1">#m: magenta</span>
    <span class="c1">#y: yellow</span>
    <span class="c1">#k: black</span>
    <span class="c1">#w: white</span>
<span class="c1">##-----------------------------</span>

<span class="k">def</span> <span class="nf">test_plot_beta_l1_zoom</span><span class="p">(</span><span class="n">DoR</span><span class="o">=</span><span class="mf">0.4292</span><span class="p">,</span> <span class="n">sgnrt</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span> <span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;&quot;&quot;Test plot for beta angle&quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">pyimgalgos.GlobalGraphics</span> <span class="k">as</span> <span class="nn">gg</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">fancy_plt</span> <span class="o">=</span> <span class="n">funcy_l1_v1</span>
    <span class="c1">#fancy_plt = funcy_l1_v0</span>

    <span class="k">if</span> <span class="n">sgnrt</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span> 

        <span class="n">cmt</span> <span class="o">=</span> <span class="s1">&#39;POS&#39;</span> <span class="c1">#&#39;-B -/+ sqrt(B*B-C)&#39;</span>
        <span class="n">cmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-DoR-</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmt</span><span class="p">,</span> <span class="n">DoR</span><span class="p">)</span>
        
        <span class="n">xarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.29</span><span class="p">,</span><span class="mf">0.29</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>

        <span class="n">y_000</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
        <span class="n">y_m05</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>  <span class="o">-</span><span class="mi">5</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
        <span class="n">y_m09</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span>  <span class="o">-</span><span class="mi">9</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
        <span class="n">y_m13</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.3</span><span class="p">,</span> <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>    
        <span class="n">y_m18</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">18</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
        <span class="n">y_m20</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
        
        <span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">gg</span><span class="o">.</span><span class="n">plotGraph</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_000</span><span class="p">,</span> <span class="n">pfmt</span><span class="o">=</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">window</span><span class="o">=</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> 
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_000</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;  0&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m05</span><span class="p">,</span><span class="s1">&#39;g.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39; -5&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m09</span><span class="p">,</span><span class="s1">&#39;y.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39; -9&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m13</span><span class="p">,</span><span class="s1">&#39;r-.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-13&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m18</span><span class="p">,</span><span class="s1">&#39;c.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-18&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m20</span><span class="p">,</span><span class="s1">&#39;b.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-20&#39;</span><span class="p">)</span>
        
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: phi=</span><span class="si">%.1f</span><span class="s1">, beta=[-20,0]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmt</span><span class="p">,</span><span class="n">phi</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sgnrt</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">:</span> 

        <span class="n">cmt</span> <span class="o">=</span> <span class="s1">&#39;NEG&#39;</span> <span class="c1">#&#39;-B -/+ sqrt(B*B-C)&#39;</span>
        <span class="n">cmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-DoR-</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmt</span><span class="p">,</span> <span class="n">DoR</span><span class="p">)</span>
        
        <span class="n">xarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>

        <span class="n">y_m20</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
        <span class="n">y_m23</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">23</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
        <span class="n">y_m25</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
        <span class="n">y_m27</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">27</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
        <span class="n">y_m30</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
        <span class="n">y_m35</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">35</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
        <span class="n">y_m40</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
        <span class="n">y_m60</span> <span class="o">=</span> <span class="p">[</span><span class="n">fancy_plt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span>   <span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xarr</span><span class="p">]</span>
        
        <span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">gg</span><span class="o">.</span><span class="n">plotGraph</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m25</span><span class="p">,</span> <span class="n">pfmt</span><span class="o">=</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">window</span><span class="o">=</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> 
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m20</span><span class="p">,</span><span class="s1">&#39;g+-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-20&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m23</span><span class="p">,</span><span class="s1">&#39;m-&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-23&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m25</span><span class="p">,</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-25&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m27</span><span class="p">,</span><span class="s1">&#39;b.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-27&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m30</span><span class="p">,</span><span class="s1">&#39;y.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-30&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m35</span><span class="p">,</span><span class="s1">&#39;r.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-35&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m40</span><span class="p">,</span><span class="s1">&#39;c.&#39;</span><span class="p">,</span>  <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-40&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">y_m60</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>   <span class="n">label</span><span class="o">=</span><span class="s1">&#39;-60&#39;</span><span class="p">)</span>
        
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: phi=</span><span class="si">%.1f</span><span class="s1">, beta=[-60,-20]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmt</span><span class="p">,</span><span class="n">phi</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="n">gg</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;test-plot-beta-l1-</span><span class="si">%s</span><span class="s1">-zoomed.png&#39;</span> <span class="o">%</span> <span class="n">cmt</span><span class="p">)</span>
    <span class="n">gg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">##-----------------------------</span>

<span class="k">def</span> <span class="nf">test_fraser</span><span class="p">()</span> <span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;&quot;&quot;Test fraser transformation&quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">pyimgalgos.GlobalGraphics</span> <span class="k">import</span> <span class="n">fig_axes</span><span class="p">,</span> <span class="n">plot_img</span><span class="p">,</span> <span class="n">store</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

    <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;/reg/neh/home1/dubrovin/LCLS/rel-mengning/plots/cspad-cxif5315-0169-000079.npy&#39;</span>

    <span class="n">img2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

    <span class="n">s12</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">recimg</span> <span class="o">=</span> <span class="n">fraser</span><span class="p">(</span><span class="n">img2d</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">store</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">store</span><span class="o">.</span><span class="n">axim</span><span class="p">,</span> <span class="n">store</span><span class="o">.</span><span class="n">axcb</span> <span class="o">=</span> <span class="n">fig_axes</span><span class="p">()</span> <span class="c1"># if not do_plot else (None, None, None)</span>
    <span class="n">plot_img</span><span class="p">(</span><span class="n">recimg</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;do not hold&#39;</span><span class="p">,</span> <span class="n">amin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">amax</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="c1">#plot_img(img2d, mode=&#39;do not hold&#39;, amin=0, amax=200)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span> <span class="c1"># hold control on show() after the last image</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#------------------------------</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span> <span class="p">:</span>

    <span class="kn">import</span> <span class="nn">sys</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span> <span class="p">:</span>
        <span class="nb">print</span> <span class="s1">&#39;For specific test use command:</span><span class="se">\n</span><span class="s1">&gt; </span><span class="si">%s</span><span class="s1"> &lt;test-id-string&gt;&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">print</span> <span class="s1">&#39;Default test: test_fraser()&#39;</span>
        <span class="n">test_fraser</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Default test is completed&#39;</span><span class="p">)</span>

    <span class="n">DoR</span> <span class="o">=</span> <span class="mi">390</span><span class="o">/</span><span class="mf">913.27</span>

    <span class="nb">print</span> <span class="s1">&#39;Test: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span>   <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;1&#39;</span> <span class="p">:</span> <span class="n">test_fraser</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;2&#39;</span> <span class="p">:</span> <span class="n">test_plot_phi</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;3&#39;</span> <span class="p">:</span> <span class="n">test_plot_beta</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;4&#39;</span> <span class="p">:</span> <span class="n">test_plot_beta_l1</span><span class="p">(</span><span class="n">DoR</span><span class="o">=</span><span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="o">=+</span><span class="mf">1.</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;5&#39;</span> <span class="p">:</span> <span class="n">test_plot_beta_l1</span><span class="p">(</span><span class="n">DoR</span><span class="o">=</span><span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="o">=-</span><span class="mf">1.</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;6&#39;</span> <span class="p">:</span> <span class="n">test_plot_beta_l0</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;7&#39;</span> <span class="p">:</span> <span class="n">test_plot_beta_l1_zoom</span><span class="p">(</span><span class="n">DoR</span><span class="o">=</span><span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="o">=+</span><span class="mf">1.</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;8&#39;</span> <span class="p">:</span> <span class="n">test_plot_beta_l1_zoom</span><span class="p">(</span><span class="n">DoR</span><span class="o">=</span><span class="n">DoR</span><span class="p">,</span> <span class="n">sgnrt</span><span class="o">=-</span><span class="mf">1.</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="nb">print</span> <span class="s1">&#39;Default test: test_fraser()&#39;</span>
        <span class="n">test_fraser</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Test </span><span class="si">%s</span><span class="s1"> is completed&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
<span class="c1">##-----------------------------</span>
<span class="c1">##-----------------------------</span>
<span class="c1">##-----------------------------</span>

</pre></div>

          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          
          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="../py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="../genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Mikhail Dubrovin.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>