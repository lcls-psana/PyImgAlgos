
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>TDFileContainer &#8212; pyimgalgos-doc 1 documentation</title>
    <link rel="stylesheet" href="../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head>
  <body>
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="../index.html">pyimgalgos-doc 1 documentation</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for TDFileContainer</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1">#------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">:py:class:`TDFileContainer` - text/table data file container - load/hold/provide access to data from text file</span>
<span class="sd">==============================================================================================================</span>

<span class="sd">It is assumed that text data file contains records of the same format and occasionally record-header</span>
<span class="sd">beginning with character # (hash in [0] position).</span>
<span class="sd">Example of the file content::</span>

<span class="sd">    # Exp     Run  Date       Time      time(sec)   time(nsec) fiduc  Evnum  Reg  Seg  Row  Col  ...</span>
<span class="sd">    cxif5315  169  2015-02-22 02:20:47  1424600447  486382070  104421     0  EQU   17  153   48  ...</span>
<span class="sd">    cxif5315  169  2015-02-22 02:20:47  1424600447  494719789  104424     1  EQU    1  161   32  ...</span>
<span class="sd">    cxif5315  169  2015-02-22 02:20:47  1424600447  494719789  104424     1  EQU   17  170   51  ...</span>
<span class="sd">    cxif5315  169  2015-02-22 02:20:47  1424600447  503058551  104427     2  EQU   25  170  310  ...</span>
<span class="sd">    cxif5315  169  2015-02-22 02:20:47  1424600447  503058551  104427     2  EQU   25  180  292  ...</span>
<span class="sd">    cxif5315  169  2015-02-22 02:20:47  1424600447  511393301  104430     3  EQU    1  162   27  ...</span>
<span class="sd">    cxif5315  169  2015-02-22 02:20:47  1424600447  536405573  104439     6  ARC    8   11   41  ...</span>
<span class="sd">    cxif5315  169  2015-02-22 02:20:47  1424600447  536405573  104439     6  ARC    8   10   20  ...</span>
<span class="sd">    ...</span>

<span class="sd">Header (without #) should have the same as data number of literal fields separated by spaces.</span>
<span class="sd">Records in the file should be grupped by unique group-id parameter,</span>
<span class="sd">for example a group of records may have the same group number or some unique index.</span>


<span class="sd">Originaly it is designed to work with text file containing record data generated by peak-finder.</span>
<span class="sd">It is adopted to work with any other object type beside peak data.</span>

<span class="sd">Usage::</span>

<span class="sd">    # !!! NOTE: None is returned whenever requested information is missing.</span>

<span class="sd">    # Import</span>
<span class="sd">    from pyimgalgos.TDFileContainer     import TDFileContainer</span>
<span class="sd">    from pyimgalgos.TDPeakRecord        import TDPeakRecord # use it by default in TDFileContainer</span>
<span class="sd">    from pyimgalgos.TDNodeRecord        import TDNodeRecord</span>
<span class="sd">    from pyimgalgos.TDCheetahPeakRecord import TDCheetahPeakRecord</span>

<span class="sd">    # Initialization</span>
<span class="sd">    # for peakfinder records</span>
<span class="sd">    fname = &#39;/reg/neh/home1/dubrovin/LCLS/rel-mengning/work/pfv2-cxif5315-r0169-2015-09-14T14:28:04.txt&#39;</span>
<span class="sd">    fc = TDFileContainer(fname, indhdr=&#39;Evnum&#39;, objtype=TDPeakRecord, pbits=0)</span>

<span class="sd">    # for index table:</span>
<span class="sd">    fc = TDFileContainer(fname, indhdr=&#39;index&#39;, objtype=TDNodeRecord)</span>

<span class="sd">    # for Cheetah file with peaks:</span>
<span class="sd">    fc = TDFileContainer(fname, indhdr=&#39;frameNumber&#39;, objtype=TDCheetahPeakRecord)</span>

<span class="sd">    gr_nums = fc.group_numbers()</span>
<span class="sd">    ngrps   = fc.number_of_groups()</span>
<span class="sd">    grnum   = fc.current_group_number()</span>

<span class="sd">    gr_curr = fc.group(grpnum) # returns current or specified group</span>
<span class="sd">    gr_next = fc.next()        # returns next group</span>
<span class="sd">    gr_prev = fc.previous()    # returns previous group</span>
<span class="sd">    hdr     = fc.header()        </span>

<span class="sd">    # Print</span>
<span class="sd">    fc.print_attrs()</span>
<span class="sd">    fc.print_content(nlines=None) # prints nline (or all by default) lines from file conteiner</span>
<span class="sd"> </span>
<span class="sd">    # ____________________________________</span>

<span class="sd">    # Example of iterations over groups</span>
<span class="sd">    for grnum in fc.group_num_iterator() :</span>
<span class="sd">        group = fc.next()</span>
<span class="sd">        group.print_attrs()</span>
<span class="sd">        peaks = group.get_objs()</span>

<span class="sd">        for pk in peaks :</span>
<span class="sd">            pk.print_short()</span>

<span class="sd">            # Information available through the TDPeakRecord object pk</span>
<span class="sd">            # ________________________________________________________</span>
<span class="sd">            # pk.exp, pk.run, pk.evnum, pk.reg</span>
<span class="sd">            # pk.date, pk.time, pk.tsec, pk.tnsec, pk.fid</span>
<span class="sd">            # pk.seg, pk.row, pk.col, pk.amax, pk.atot, pk.npix</span>
<span class="sd">            # pk.rcent, pk.ccent, pk.rsigma, pk.csigma</span>
<span class="sd">            # pk.rmin, pk.rmax, pk.cmin, pk.cmax</span>
<span class="sd">            # pk.bkgd, pk.rms, pk.son</span>
<span class="sd">            # pk.imrow, pk.imcol</span>
<span class="sd">            # pk.x, pk.y, pk.r, pk.phi</span>
<span class="sd">            # pk.sonc</span>
<span class="sd">            # pk.dphi000</span>
<span class="sd">            # pk.dphi180</span>
<span class="sd">            # pk.line</span>

<span class="sd">    # Example of direct access to group by its number</span>
<span class="sd">    grpnum = 8 # but grpnum is not necessaraly conecutive number, it should be in fc.group_num_iterator() ...</span>
<span class="sd">    group = fc.group(grpnum) # returns current or specified group</span>
<span class="sd">    group.print_attrs()</span>

<span class="sd">This software was developed for the LCLS project.</span>
<span class="sd">If you use all or part of it, please give an appropriate acknowledgment.</span>

<span class="sd">See classes:</span>
<span class="sd">  - :py:class:`pyimgalgos.TDFileContainer` - file records container. </span>
<span class="sd">  - :py:class:`pyimgalgos.TDGroup` - holds a list of records associated with a single group.</span>
<span class="sd">  - :py:class:`pyimgalgos.TDPeakRecord` - provides access to the peak record.</span>
<span class="sd">  - :py:class:`pyimgalgos.TDNodeRecord` - provides access to the look-up table with crystal orientation record.</span>
<span class="sd">  - :py:class:`pyimgalgos.TDCheetahPeakRecord` - provides access to the Cheetah peak record.</span>

<span class="sd">See:</span>
<span class="sd">  - :py:class:`Graphics`</span>
<span class="sd">  - :py:class:`GlobalGraphics`</span>
<span class="sd">  - :py:class:`GlobalUtils`</span>
<span class="sd">  - :py:class:`NDArrGenerators`</span>
<span class="sd">  - :py:class:`Quaternion`</span>
<span class="sd">  - :py:class:`FiberAngles`</span>
<span class="sd">  - :py:class:`FiberIndexing`</span>
<span class="sd">  - :py:class:`PeakData`</span>
<span class="sd">  - :py:class:`PeakStore`</span>
<span class="sd">  - :py:class:`TDCheetahPeakRecord`</span>
<span class="sd">  - :py:class:`TDFileContainer`</span>
<span class="sd">  - :py:class:`TDGroup`</span>
<span class="sd">  - :py:class:`TDMatchRecord`</span>
<span class="sd">  - :py:class:`TDNodeRecord`</span>
<span class="sd">  - :py:class:`TDPeakRecord`</span>
<span class="sd">  - :py:class:`HBins`</span>
<span class="sd">  - :py:class:`HPolar`</span>
<span class="sd">  - :py:class:`HSpectrum`</span>
<span class="sd">  - :py:class:`RadialBkgd`</span>
<span class="sd">  - `Analysis of data for cxif5315 &lt;https://confluence.slac.stanford.edu/display/PSDMInternal/Analysis+of+data+for+cxif5315&gt;`_.</span>

<span class="sd">Created in 2015 by Mikhail Dubrovin</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#------------------------------</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;$Revision$&quot;</span>
<span class="c1"># $Source$</span>
<span class="c1">##-----------------------------</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="c1">#import sys</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">time</span>

<span class="kn">from</span> <span class="nn">pyimgalgos.TDGroup</span> <span class="k">import</span> <span class="n">TDGroup</span>
<span class="kn">from</span> <span class="nn">pyimgalgos.TDPeakRecord</span>  <span class="k">import</span> <span class="n">TDPeakRecord</span>

<span class="c1">##-----------------------------</span>
<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer">[docs]</a><span class="k">class</span> <span class="nc">TDFileContainer</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Load and hold record list from file and provide access by group index</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TDFileContainer.__init__"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">indhdr</span><span class="o">=</span><span class="s1">&#39;Evnum&#39;</span><span class="p">,</span> <span class="n">objtype</span><span class="o">=</span><span class="n">TDPeakRecord</span><span class="p">,</span> <span class="n">pbits</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Constructor</span>
<span class="sd">           Args:</span>
<span class="sd">           fname   (str) - text table data file name </span>
<span class="sd">           indhdr  (str) - header of the field used for group indexing</span>
<span class="sd">           objtype (TD*Recor) - object type used for data record processing/access</span>
<span class="sd">           pbits   (int) - print control bit-word; pbits &amp; 256 - tracking</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pbits</span> <span class="o">&amp;</span> <span class="mi">256</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;c-tor of class </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indhdr</span> <span class="o">=</span> <span class="n">indhdr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span> <span class="o">=</span> <span class="n">objtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span> <span class="o">=</span> <span class="n">pbits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hdr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grnum</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1">#self.lst_of_recs = [] # list of recs loaded from record data file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lst_grnum</span>    <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of group numbers in the data file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lst_begin</span>    <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of record indexes in the lst_of_recs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lst_nrecords</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of numbor of records in group </span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_load_recs_from_file</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_group_indexing</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_indexes</span><span class="p">()</span></div>

<span class="c1">##-----------------------------</span>

    <span class="k">def</span> <span class="nf">_reset_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; resets indexes for iterator</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">first_iteration</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grnum_curr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst_grnum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># reset current group after indexing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indlst_curr</span> <span class="o">=</span> <span class="mi">0</span>                <span class="c1"># reset current index of internal lists</span>
         
<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.__del__"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.__del__">[docs]</a>    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;d-tor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span> <span class="o">&amp;</span> <span class="mi">256</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;d-tor of class </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">pass</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.__call__"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Alias to group_num_iterator()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_num_iterator</span><span class="p">()</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.print_content"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.print_content">[docs]</a>    <span class="k">def</span> <span class="nf">print_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nlines</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Prints content of the file-container; by default-entire file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span> <span class="o">&amp;</span> <span class="mi">256</span> <span class="p">:</span> <span class="nb">print</span> <span class="s2">&quot;&quot;&quot;default method of class </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="nb">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">120</span><span class="o">*</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1"> holds data from file:</span><span class="se">\n</span><span class="s1">  </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">rec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lst_of_recs</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">nlines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&gt;</span><span class="n">nlines</span> <span class="p">:</span> <span class="k">break</span>
            <span class="nb">print</span> <span class="n">rec</span><span class="p">,</span>
        <span class="nb">print</span> <span class="s1">&#39;etc.&#39;</span> <span class="k">if</span> <span class="n">nlines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;End of file&#39;</span></div>

<span class="c1">##-----------------------------</span>

    <span class="k">def</span> <span class="nf">print_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">print</span> <span class="s1">&#39;Attributes of the class </span><span class="si">%s</span><span class="s1"> object&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="nb">print</span> <span class="s1">&#39;  fname : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span>\
              <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  pbits : </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span><span class="p">,</span>\
              <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  hdr   : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr</span><span class="p">,</span>\
              <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  nrecs : </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lst_of_recs</span><span class="p">),</span>\
              <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  Auto-defined grnum index in the record data : </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">igrnum</span>

<span class="c1">##-----------------------------</span>

    <span class="k">def</span> <span class="nf">_load_recs_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lexists</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;File </span><span class="si">%s</span><span class="s1"> is not found&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span>
        <span class="n">t0_sec</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lst_of_recs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">f</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst_of_recs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span> <span class="o">&amp;</span> <span class="mi">256</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;File loading time </span><span class="si">%.3f</span><span class="s1"> sec&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t0_sec</span><span class="p">)</span>

<span class="c1">##-----------------------------</span>

    <span class="k">def</span> <span class="nf">_load_recs_from_file_v0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lexists</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;File </span><span class="si">%s</span><span class="s1"> is not found&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span>
        <span class="n">t0_sec</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lst_of_recs</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span> <span class="o">&amp;</span> <span class="mi">256</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;File loading time </span><span class="si">%.3f</span><span class="s1"> sec&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t0_sec</span><span class="p">)</span>

<span class="c1">##-----------------------------</span>

    <span class="k">def</span> <span class="nf">_part_rec_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; 1. saves the 1st header in self.hdr, return None for header</span>
<span class="sd">            2. defines index of the field self.indhdr (=&#39;Evnum&#39;)</span>
<span class="sd">            3. returns None for empty recs (if any)</span>
<span class="sd">            4. returns group number found in the record data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">None</span> <span class="c1"># ignore empty records</span>

        <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;#&#39;</span> <span class="p">:</span> <span class="c1"># rec is header or comment</span>
            <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">hdr</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indhdr</span> <span class="ow">in</span> <span class="n">rec</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">hdr</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">igrnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr</span><span class="o">.</span><span class="n">split</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indhdr</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span> <span class="o">&amp;</span> <span class="mi">256</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;self.igrnum&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">igrnum</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># partly split data fields and return group number</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">igrnum</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>    
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">igrnum</span><span class="p">])</span>

<span class="c1">##-----------------------------</span>

    <span class="k">def</span> <span class="nf">_group_indexing</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;loops over list of records, makes lists for indexing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span> <span class="o">&amp;</span> <span class="mi">256</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;_group_indexing&#39;</span>
        <span class="n">t0_sec</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lst_of_recs</span><span class="p">)</span> <span class="p">:</span>

            <span class="n">grnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_part_rec_parser</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">grnum</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="k">continue</span> <span class="c1"># in case of comments and empty recs</span>

            <span class="c1"># check if record is from the next group and add it to the list</span>
            <span class="k">if</span> <span class="n">grnum</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grnum</span> <span class="p">:</span>                
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grnum</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">:</span> <span class="c1"># skip 1st record</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lst_nrecords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grnum</span> <span class="o">=</span> <span class="n">grnum</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lst_grnum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grnum</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lst_begin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
                 
                <span class="c1">#print &#39;New group number: %d&#39; % grnum</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1">#==== TEST ======</span>
            <span class="c1">#if ind&gt;100 : break</span>
            <span class="c1">#print rec</span>
            <span class="c1">#================</span>
 
        <span class="bp">self</span><span class="o">.</span><span class="n">lst_nrecords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="c1"># add for last record</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span> <span class="o">&amp;</span> <span class="mi">256</span> <span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;Last group </span><span class="si">%d</span><span class="s1"> contains </span><span class="si">%d</span><span class="s1"> records&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grnum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
            <span class="nb">print</span> <span class="s1">&#39;Group indexing time </span><span class="si">%.3f</span><span class="s1"> sec&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t0_sec</span><span class="p">)</span>

<span class="c1">##-----------------------------</span>
<span class="c1"># This is time consuming operation</span>
<span class="c1">#    def list_of_groups(self) :</span>
<span class="c1">#        &quot;&quot;&quot;returns list of group objects</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        self._reset_indexes()</span>
<span class="c1">#        return [self.next() for grnum in self.lst_grnum]</span>
<span class="c1">#</span>
<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.group_numbers"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.group_numbers">[docs]</a>    <span class="k">def</span> <span class="nf">group_numbers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;returns list of group numbers in the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst_grnum</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.group_num_iterator"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.group_num_iterator">[docs]</a>    <span class="k">def</span> <span class="nf">group_num_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;resets indexes to the beginning of arrays and returns list of group numbers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_indexes</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst_grnum</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.number_of_groups"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.number_of_groups">[docs]</a>    <span class="k">def</span> <span class="nf">number_of_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;returns number of groups in file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lst_grnum</span><span class="p">)</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.current_group_number"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.current_group_number">[docs]</a>    <span class="k">def</span> <span class="nf">current_group_number</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;returns current group number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">grnum_curr</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.header"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.header">[docs]</a>    <span class="k">def</span> <span class="nf">header</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;returns string header</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hdr</span></div>

<span class="c1">##-----------------------------</span>

    <span class="k">def</span> <span class="nf">_group_for_index</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;returns group for specified range of indexes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grnum_curr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst_grnum</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indlst_curr</span><span class="p">]</span>
        <span class="n">begin</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst_begin</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indlst_curr</span><span class="p">]</span>
        <span class="n">nrecords</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst_nrecords</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indlst_curr</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span> <span class="o">&amp;</span> <span class="mi">256</span> <span class="p">:</span> 
            <span class="nb">print</span> <span class="s1">&#39;grnum_curr=</span><span class="si">%d</span><span class="s1">  indlst_curr=</span><span class="si">%d</span><span class="s1">  begin=</span><span class="si">%d</span><span class="s1">  nrecords=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>\
                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grnum_curr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indlst_curr</span><span class="p">,</span> <span class="n">begin</span><span class="p">,</span> <span class="n">nrecords</span><span class="p">)</span>

        <span class="n">evt_recs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst_of_recs</span><span class="p">[</span><span class="n">begin</span><span class="p">:</span><span class="n">begin</span><span class="o">+</span><span class="n">nrecords</span><span class="p">]</span>
        <span class="c1">#print &#39;%s\nList of records for group %d&#39; % (80*&#39;_&#39;, self.grnum)</span>
        <span class="c1">#for rec in recs : print rec</span>

        <span class="k">return</span> <span class="n">TDGroup</span><span class="p">(</span><span class="n">evt_recs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span><span class="p">,</span> <span class="n">pbits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pbits</span><span class="p">)</span>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.group"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.group">[docs]</a>    <span class="k">def</span> <span class="nf">group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grnum</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;returns current or specified group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span> <span class="o">&amp;</span> <span class="mi">256</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;group(evnum=</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">grnum</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">grnum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">grnum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst_grnum</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indlst_curr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lst_grnum</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">grnum</span><span class="p">)</span>        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_for_index</span><span class="p">()</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.next"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;returns next group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span> <span class="o">&amp;</span> <span class="mi">256</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;next group&#39;</span>

        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">first_iteration</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_iteration</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_for_index</span><span class="p">()</span> <span class="c1"># do not increment indexes on first iteration</span>

        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">indlst_curr</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lst_grnum</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indlst_curr</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_for_index</span><span class="p">()</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;WARNING: </span><span class="si">%s</span><span class="s1">.next() reached the end of the list, return None&#39;</span><span class="o">%</span>\
               <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.previous"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.previous">[docs]</a>    <span class="k">def</span> <span class="nf">previous</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;returns previous group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span> <span class="o">&amp;</span> <span class="mi">256</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;previous group&#39;</span>

        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">first_iteration</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_iteration</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_for_index</span><span class="p">()</span> <span class="c1"># do not decrement indexes on first iteration</span>

        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">indlst_curr</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indlst_curr</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group_for_index</span><span class="p">()</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbits</span> <span class="p">:</span> <span class="nb">print</span> <span class="s1">&#39;WARNING: </span><span class="si">%s</span><span class="s1">.previous() reached the beginning of the list, return None&#39;</span><span class="o">%</span>\
               <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">return</span> <span class="kc">None</span></div>


<span class="c1">##-----------------------------</span>
<span class="c1">##-----------------------------</span>
<span class="c1">## Aliases for depricated names</span>
<span class="c1">##-----------------------------</span>
<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.event_numbers"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.event_numbers">[docs]</a>    <span class="k">def</span> <span class="nf">event_numbers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Depricated, see group_numbers()&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_numbers</span><span class="p">()</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.evnum_iterator"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.evnum_iterator">[docs]</a>    <span class="k">def</span> <span class="nf">evnum_iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Depricated, see group_num_iterator()&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_num_iterator</span><span class="p">()</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.number_of_events"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.number_of_events">[docs]</a>    <span class="k">def</span> <span class="nf">number_of_events</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Depricated, see number_of_groups()&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_groups</span><span class="p">()</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.current_event_number"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.current_event_number">[docs]</a>    <span class="k">def</span> <span class="nf">current_event_number</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Depricated, see current_group_number()&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_group_number</span><span class="p">()</span></div>

<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="TDFileContainer.event"><a class="viewcode-back" href="../index.html#TDFileContainer.TDFileContainer.event">[docs]</a>    <span class="k">def</span> <span class="nf">event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evnum</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Depricated, see group(evnum)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">grnum</span><span class="o">=</span><span class="n">evnum</span><span class="p">)</span></div></div>

<span class="c1">##-----------------------------</span>
<span class="c1">##-----------------------------</span>
<span class="c1">##-----------------------------</span>
<span class="c1">##-----------------------------</span>
<span class="c1">##-----------------------------</span>

<div class="viewcode-block" id="do_work"><a class="viewcode-back" href="../index.html#TDFileContainer.do_work">[docs]</a><span class="k">def</span> <span class="nf">do_work</span><span class="p">()</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Test</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;/reg/neh/home1/dubrovin/LCLS/rel-mengning/work/pfv2-cxif5315-r0169-2015-09-14T14:28:04.txt&#39;</span>
    <span class="n">fc</span> <span class="o">=</span> <span class="n">TDFileContainer</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">indhdr</span><span class="o">=</span><span class="s1">&#39;Evnum&#39;</span><span class="p">,</span> <span class="n">objtype</span><span class="o">=</span><span class="n">TDPeakRecord</span><span class="p">,</span> <span class="n">pbits</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">fc</span><span class="o">.</span><span class="n">print_attrs</span><span class="p">()</span>
    <span class="n">fc</span><span class="p">()</span>

    <span class="c1"># Direct access to TDGroup object</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">fc</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">group</span><span class="o">.</span><span class="n">print_attrs</span><span class="p">()</span>

    <span class="n">t0_sec</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">grpnum</span> <span class="ow">in</span> <span class="n">fc</span><span class="o">.</span><span class="n">group_num_iterator</span><span class="p">()</span> <span class="p">:</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">fc</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="nb">print</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">Group </span><span class="si">%d</span><span class="s1">  &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">80</span><span class="o">*</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">grpnum</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">group</span><span class="p">()</span> <span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39; &#39;</span><span class="p">,</span>
            <span class="n">record</span><span class="o">.</span><span class="n">print_short</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">peak</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">group</span><span class="p">())</span> <span class="p">:</span>
            <span class="nb">print</span> <span class="s1">&#39;  peak#</span><span class="si">%2d</span><span class="s1">  bkgd=</span><span class="si">%5.1f</span><span class="s1">  rms=</span><span class="si">%5.1f</span><span class="s1">  S/N=</span><span class="si">%5.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">peak</span><span class="o">.</span><span class="n">bkgd</span><span class="p">,</span> <span class="n">peak</span><span class="o">.</span><span class="n">rms</span><span class="p">,</span> <span class="n">peak</span><span class="o">.</span><span class="n">son</span><span class="p">)</span>
        
    <span class="nb">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Time to iterate using next() </span><span class="si">%.3f</span><span class="s1"> sec&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t0_sec</span><span class="p">)</span></div>

    <span class="c1">#t0_sec = time()</span>
    <span class="c1">#groups = fc.list_of_groups()  </span>
    <span class="c1">#print &#39;Time to generate list of group objects %.3f sec&#39; % (time()-t0_sec)</span>

<span class="c1">##-----------------------------</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span> <span class="p">:</span>
    <span class="n">do_work</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test is completed&#39;</span><span class="p">)</span>
    <span class="c1">#sys.exit(&#39;Processing is completed&#39;)</span>

<span class="c1">##-----------------------------</span>
</pre></div>

          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          
          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="../py-modindex.html" title="Python Module Index"
              >modules</a> |
            <a href="../genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Mikhail Dubrovin.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>